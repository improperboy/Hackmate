# .htaccess for Hackathon Management System
# Optimized for InfinityFree hosting

# Enable URL rewriting
RewriteEngine On

# Force HTTPS (optional - uncomment if you have SSL)
# RewriteCond %{HTTPS} off
# RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# Security: Protect sensitive files and directories
<IfModule mod_php.c>
<Files ~ "\.(sql|env|log|ini|bak|config)$">
    Order allow,deny
    Deny from all
</Files>

# Protect includes directory
<Files "includes/*">
    Order allow,deny
    Deny from all
</Files>

# Protect scripts directory
<Files "scripts/*">
    Order allow,deny
    Deny from all
</Files>
</IfModule>

# Protect vendor directory from direct access
<IfModule mod_php.c>
<Files "vendor/*">
    Order allow,deny
    Deny from all
</Files>
</IfModule>

# Protect composer files
<IfModule mod_php.c>
<Files ~ "^(composer\.(json|lock)|package\.(json|lock)|\.git.*|\.env.*|README\.md)$">
    Order allow,deny
    Deny from all
</Files>
</IfModule>

# PHP Security Settings (Basic - InfinityFree compatible)
<IfModule mod_php.c>
php_flag display_errors Off
php_flag log_errors On
</IfModule>

# Session Configuration for InfinityFree hosting
# Note: Some hosts don't allow php_value in .htaccess
# If you get 500 errors, comment out the lines below
<IfModule mod_php.c>
    php_value session.use_cookies 1
    php_value session.use_only_cookies 1
    php_value session.cookie_lifetime 0
    php_value session.cookie_path /
    php_value session.cookie_httponly 1
    php_value session.gc_maxlifetime 7200
    php_value session.name HACKMATE_SESSID
</IfModule>

# Enable compression if available
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
</IfModule>

# Cache control for static files
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpg "access plus 1 month"
    ExpiresByType image/jpeg "access plus 1 month"
    ExpiresByType image/gif "access plus 1 month"
    ExpiresByType image/png "access plus 1 month"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/pdf "access plus 1 month"
    ExpiresByType text/javascript "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType application/x-javascript "access plus 1 month"
    ExpiresByType application/x-shockwave-flash "access plus 1 month"
    ExpiresByType image/x-icon "access plus 1 year"
    ExpiresDefault "access plus 2 days"
</IfModule>

# Prevent access to hidden files
<IfModule mod_php.c>
<Files ~ "^\.">
    Order allow,deny
    Deny from all
</Files>
</IfModule>

# Custom error pages (optional)
ErrorDocument 404 /404.html
ErrorDocument 500 /500.html

# Directory browsing protection
Options -Indexes

# Remove .php extension
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}\.php -f
RewriteRule ^([^/]+)/?$ $1.php [L]

# Your normal routes
RewriteRule ^admin/dashboard/?$ admin/dashboard.php [L]
RewriteRule ^participant/dashboard/?$ participant/dshboard.php [L]

# ================================
# Global fallback: if not a real file/folder â†’ go to login.php
# ================================
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^.*$ /login.php [L,R=302]

# Prevent access to PHP error logs
<IfModule mod_php.c>
<Files ~ "error_log">
    Order allow,deny
    Deny from all
</Files>
</IfModule>
